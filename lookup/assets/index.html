<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <title>Phone number lookup</title>
    <link
      rel="icon"
      href="https://twilio-labs.github.io/function-templates/static/v1/favicon.ico"
    />
    <link
      rel="stylesheet"
      href="https://twilio-labs.github.io/function-templates/static/v1/ce-paste-theme.css"
    />
    <link rel="stylesheet" href="styles.css" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/intl-tel-input@17.0.13/build/css/intlTelInput.min.css"
      integrity="sha256-xpVuhxDPR39wFEQDha4W7kuMx+z9Av3dTS8MbH/RWEU="
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/intl-tel-input@17.0.13/build/js/intlTelInput.min.js"
      integrity="sha256-uPbemOnf3P4eaeLHebLwPC71YRbu3WNBvO4ibYeBnGs="
      crossorigin="anonymous"
    ></script>
  </head>
  <body>
    <div class="page-top">
      <header>
        <div id="twilio-logo">
          <a href="https://www.twilio.com/" target="_blank" rel="noopener">
            <svg
              class="logo"
              data-name="Layer 1"
              xmlns="http://www.w3.org/2000/svg"
              viewbox="0 0 60 60"
            >
              <title>Twilio Logo</title>
              <path
                class="cls-1"
                d="M30,15A15,15,0,1,0,45,30,15,15,0,0,0,30,15Zm0,26A11,11,0,1,1,41,30,11,11,0,0,1,30,41Zm6.8-14.7a3.1,3.1,0,1,1-3.1-3.1A3.12,3.12,0,0,1,36.8,26.3Zm0,7.4a3.1,3.1,0,1,1-3.1-3.1A3.12,3.12,0,0,1,36.8,33.7Zm-7.4,0a3.1,3.1,0,1,1-3.1-3.1A3.12,3.12,0,0,1,29.4,33.7Zm0-7.4a3.1,3.1,0,1,1-3.1-3.1A3.12,3.12,0,0,1,29.4,26.3Z"
              />
            </svg>
          </a>
        </div>
        <nav>
          <span>Your Twilio application</span>
          <aside>
            <svg
              class="icon"
              role="img"
              aria-hidden="true"
              width="100%"
              height="100%"
              viewBox="0 0 20 20"
              aria-labelledby="NewIcon-1577"
            >
              <path
                fill="currentColor"
                fill-rule="evenodd"
                d="M6.991 7.507c.003-.679 1.021-.675 1.019.004-.012 2.956 1.388 4.41 4.492 4.48.673.016.66 1.021-.013 1.019-2.898-.011-4.327 1.446-4.48 4.506-.033.658-1.01.639-1.018-.02-.03-3.027-1.382-4.49-4.481-4.486-.675 0-.682-1.009-.008-1.019 3.02-.042 4.478-1.452 4.49-4.484zm.505 2.757l-.115.242c-.459.9-1.166 1.558-2.115 1.976l.176.08c.973.465 1.664 1.211 2.083 2.22l.02.05.088-.192c.464-.973 1.173-1.685 2.123-2.124l.039-.018-.118-.05c-.963-.435-1.667-1.117-2.113-2.034l-.068-.15zm10.357-8.12c.174.17.194.434.058.625l-.058.068-1.954 1.905 1.954 1.908a.482.482 0 010 .694.512.512 0 01-.641.056l-.07-.056-1.954-1.908-1.954 1.908a.511.511 0 01-.71 0 .482.482 0 01-.058-.626l.058-.068 1.954-1.908-1.954-1.905a.482.482 0 010-.693.512.512 0 01.64-.057l.07.057 1.954 1.905 1.954-1.905a.511.511 0 01.71 0z"
              ></path>
            </svg>
            Live
          </aside>
        </nav>
      </header>
    </div>
    <main>
      <div class="content">
        <h2>Phone number lookup</h2>
        <p>
          This example shows how to process and parse international phone
          numbers with the
          <a href="https://github.com/jackocnr/intl-tel-input">
            <code>intl-tel-input</code>
          </a>
          library and detect invalid phone numbers, line type, carrier
          information, caller name, and more with the
          <a href="https://twilio.com/docs/lookup/api">Twilio Lookup API</a>.
        </p>
        <ul>
          <li>
            üí∞
            <a
              href="https://www.twilio.com/en-us/user-authentication-identity/pricing/lookup"
              >Pricing by package and country.</a
            >
          </li>
          <li>
            üìñ
            <a href="https://www.twilio.com/docs/lookup/v2-api#data-packages"
              >Package descriptions and availability</a
            >
          </li>
        </ul>
        <div>
          <form id="lookup">
            <p>Enter your phone number</p>
            <input id="phone" type="tel" name="phone" />
            <p>
              Select your data packages
              <a href="https://www.twilio.com/docs/lookup/v2-api#data-packages"
                >[learn more]</a
              >
            </p>
            <div>
              <input
                type="checkbox"
                id="validation"
                name="fields"
                value="validation"
                checked
                disabled
              />
              <label for="validation">Validation and Formatting [free]</label
              ><br />
            </div>
            <div>
              <input
                type="checkbox"
                id="lti"
                name="fields"
                value="line_type_intelligence"
              />
              <label for="lti"
                ><a
                  href="https://www.twilio.com/docs/lookup/v2-api/line-type-intelligence"
                  >Line Type Intelligence</a
                ></label
              ><br />
            </div>
            <div>
              <input
                type="checkbox"
                id="callerName"
                name="fields"
                value="caller_name"
              />
              <label for="callerName">
                <a href="https://www.twilio.com/docs/lookup/v2-api/caller-name"
                  >Caller Name</a
                > </label
              ><br />
            </div>
            <div>
              <input
                type="checkbox"
                id="smsPumpingRisk"
                name="fields"
                value="sms_pumping_risk"
              />
              <label for="smsPumpingRisk">
                <a
                  href="https://www.twilio.com/docs/lookup/v2-api/sms-pumping-risk"
                  >SMS Pumping Risk</a
                ></label
              ><br />
            </div>
            <div>
              <input
                type="checkbox"
                id="simSwap"
                name="fields"
                value="sim_swap"
              />
              <label for="simSwap">
                <a href="https://www.twilio.com/docs/lookup/v2-api/sim-swap"
                  >SIM Swap</a
                >*</label
              ><br />
            </div>
            <div>
              <input
                type="checkbox"
                id="callForwarding"
                name="fields"
                value="call_forwarding"
              />
              <label for="callForwarding">
                <a
                  href="https://www.twilio.com/docs/lookup/v2-api/call-forwarding"
                  >Call Forwarding</a
                >*</label
              ><br />
            </div>
            <div>
              <input
                type="checkbox"
                id="lineStatus"
                name="fields"
                value="line_status"
              />
              <label for="lineStatus">
                <a href="https://www.twilio.com/docs/lookup/v2-api/line-status"
                  >Line Status</a
                >*</label
              ><br />
            </div>
            <input type="submit" class="btn" value="Lookup" />
            <p>
              * Additional carrier approval required prior to use.
              <a
                href="https://twlo.my.salesforce-sites.com/countrycarrier/SN_CarrierRegistration_VFP"
                >Submit this form to request access.</a
              >
            </p>
          </form>
          <div class="alert" style="display: none"></div>
          <h3>Additional Lookup Data Packages</h3>
          <p>
            üëÄ
            <strong
              ><a
                href="https://www.twilio.com/docs/lookup/v2-api/identity-match"
                >Identity Match</a
              ></strong
            >
            and
            <strong
              ><a
                href="https://www.twilio.com/docs/lookup/v2-api/reassigned-number"
                >Reassigned Number</a
              ></strong
            >
            packages require additional details in the request.
            <a
              href="https://www.twilio.com/en-us/blog/confirm-phone-number-ownership-lookup-identity-match"
              >Learn more about Identity Match in this blog post.</a
            >
          </p>
          <p>
            ‚úèÔ∏è
            <strong
              ><a
                href="https://www.twilio.com/docs/lookup/v2-api/identity-match"
                >Identity Pre-fill</a
              ></strong
            >
            combines Verify and Lookup for a seamless onboarding experience.
            <a
              href="https://www.twilio.com/code-exchange/verify-lookup-identity-prefill"
              >Learn more in this Code Exchange project.</a
            >
          </p>
        </div>
      </div>
    </main>
    <footer>
      <span>We can't wait to see what you build.</span>
    </footer>
    <script>
      // Handle international prefixes, format phone input field
      // Uses intl-tel-input plugin
      const phoneInputField = document.querySelector("#phone");
      const phoneInput = window.intlTelInput(phoneInputField, {
        // https://en.wikipedia.org/wiki/ISO_3166-1_alpha-2
        preferredCountries: ["us", "co", "in", "de"],
        utilsScript:
          "https://cdn.jsdelivr.net/npm/intl-tel-input@17.0.13/build/js/utils.js",
      });

      const alert = document.querySelector(".alert");
      function displayAlert(message, type) {
        let replace = type === "error" ? "info" : "error";
        alert.style.display = "";
        alert.classList.replace(replace, type) || alert.classList.add(type);
        alert.innerHTML = message;
      }

      async function lookup(event) {
        event.preventDefault();
        alert.style.display = "none";

        try {
          const phoneNumber = phoneInput.getNumber();

          const data = {
            phone: phoneNumber,
            fields: Array.from(
              document.querySelectorAll("input[name=fields]:checked")
            ).map((t) => t.value),
          };

          const response = await fetch("./lookup", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(data),
          });

          const json = await response.json();
          alert.style.display = "";
          if (response.status === 200) {
            displayAlert(`<pre>${JSON.stringify(json, null, 2)}</pre>`, "info");
          } else {
            console.error(json.error);
            displayAlert(json.error, "error");
          }
        } catch (err) {
          console.error(err);
          displayAlert("Something went wrong.", "error");
        }
      }

      const form = document.getElementById("lookup");
      form.addEventListener("submit", (event) => lookup(event));
    </script>
  </body>
</html>
